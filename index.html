<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üí© CacaFinder ‚Äî Moteur de Recherche Ultime</title>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --brown-dark: #3B1F0A;
      --brown-mid: #7B3F00;
      --brown-light: #C8813A;
      --cream: #FFF8EC;
      --accent: #FFD54F;
      --card-bg: #FFF3E0;
      --shadow: rgba(59,31,10,0.18);
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: var(--cream);
      font-family: 'Nunito', sans-serif;
      min-height: 100vh; overflow-x: hidden;
      background-image:
        radial-gradient(ellipse at 10% 20%, #ffe0a0 0%, transparent 50%),
        radial-gradient(ellipse at 90% 80%, #ffd580 0%, transparent 50%);
    }
    .bg-emojis { position: fixed; inset: 0; pointer-events: none; z-index: 0; overflow: hidden; }
    .bg-emojis span { position: absolute; opacity: 0.07; animation: floatUp linear infinite; }
    @keyframes floatUp {
      from { transform: translateY(110vh) rotate(0deg); }
      to   { transform: translateY(-10vh) rotate(360deg); }
    }
    .wrapper { position: relative; z-index: 1; max-width: 860px; margin: 0 auto; padding: 2rem 1.5rem 4rem; }
    header { text-align: center; padding: 2.5rem 0 1.5rem; animation: dropIn 0.7s cubic-bezier(.34,1.56,.64,1) both; }
    @keyframes dropIn {
      from { opacity: 0; transform: translateY(-40px) scale(0.85); }
      to   { opacity: 1; transform: translateY(0) scale(1); }
    }
    .logo { font-size: 6rem; line-height: 1; filter: drop-shadow(0 6px 16px rgba(123,63,0,0.3)); display: block; animation: wiggle 2.5s ease-in-out infinite; }
    @keyframes wiggle {
      0%,100% { transform: rotate(-5deg) scale(1); }
      50% { transform: rotate(5deg) scale(1.08); }
    }
    h1 { font-family: 'Fredoka One', cursive; font-size: clamp(2.2rem, 6vw, 3.5rem); color: var(--brown-dark); margin-top: 0.5rem; }
    h1 span { color: var(--brown-mid); }
    .tagline { color: var(--brown-light); font-size: 1.05rem; font-weight: 700; margin-top: 0.4rem; letter-spacing: 0.05em; text-transform: uppercase; }

    /* API Key */
    .apikey-section { margin: 2rem 0 1rem; animation: dropIn 0.8s 0.1s cubic-bezier(.34,1.56,.64,1) both; }
    .apikey-box { background: #fff; border: 3px solid var(--brown-dark); border-radius: 20px; padding: 1.3rem 1.5rem; box-shadow: 4px 6px 0 var(--brown-dark); }
    .apikey-box label { display: block; font-family: 'Fredoka One', cursive; font-size: 1.1rem; color: var(--brown-dark); margin-bottom: 0.6rem; }
    .apikey-row { display: flex; border-radius: 50px; overflow: hidden; border: 2px solid var(--brown-dark); }
    .apikey-row input { flex: 1; padding: 0.75rem 1.2rem; font-family: 'Nunito', sans-serif; font-size: 0.97rem; font-weight: 700; border: none; outline: none; background: var(--cream); color: var(--brown-dark); }
    .apikey-row input::placeholder { color: #c8a87a; }
    .apikey-row button { background: var(--brown-dark); color: var(--accent); border: none; padding: 0 1.5rem; font-family: 'Fredoka One', cursive; font-size: 1rem; cursor: pointer; transition: background 0.2s; white-space: nowrap; }
    .apikey-row button:hover { background: var(--brown-mid); }
    .apikey-hint { margin-top: 0.6rem; font-size: 0.8rem; color: var(--brown-light); font-weight: 600; }
    .apikey-hint a { color: var(--brown-mid); }
    .key-saved { display: inline-flex; align-items: center; gap: 0.4rem; background: #e8f5e9; border: 2px solid #388e3c; border-radius: 30px; padding: 0.25rem 1rem; font-size: 0.82rem; font-weight: 800; color: #2e7d32; cursor: pointer; transition: opacity 0.2s; }
    .key-saved:hover { opacity: 0.7; }

    /* Search */
    .search-section { margin: 2.5rem 0 2rem; animation: dropIn 0.8s 0.15s cubic-bezier(.34,1.56,.64,1) both; }
    .search-box { display: flex; border-radius: 60px; overflow: hidden; box-shadow: 0 8px 32px var(--shadow), 0 2px 0 var(--brown-light); border: 3px solid var(--brown-dark); }
    .search-box input { flex: 1; padding: 1rem 1.5rem; font-family: 'Nunito', sans-serif; font-size: 1.1rem; font-weight: 700; border: none; outline: none; background: #fff; color: var(--brown-dark); }
    .search-box input::placeholder { color: #c8a87a; }
    .search-box button { background: var(--brown-dark); color: var(--accent); border: none; padding: 0 2rem; font-family: 'Fredoka One', cursive; font-size: 1.15rem; cursor: pointer; transition: background 0.2s, transform 0.1s; white-space: nowrap; }
    .search-box button:hover { background: var(--brown-mid); }
    .search-box button:active { transform: scale(0.96); }
    .quick-tags { margin-top: 1rem; display: flex; flex-wrap: wrap; gap: 0.5rem; justify-content: center; }
    .tag { background: var(--brown-dark); color: var(--accent); border: none; padding: 0.35rem 1rem; border-radius: 30px; font-family: 'Nunito', sans-serif; font-weight: 800; font-size: 0.85rem; cursor: pointer; transition: all 0.2s; }
    .tag:hover { background: var(--brown-mid); transform: translateY(-2px); }

    /* Status */
    .status { text-align: center; padding: 1rem; font-weight: 700; color: var(--brown-mid); font-size: 1rem; min-height: 2rem; }
    .spinner { display: inline-block; width: 26px; height: 26px; border: 4px solid var(--accent); border-top-color: var(--brown-dark); border-radius: 50%; animation: spin 0.7s linear infinite; vertical-align: middle; margin-right: 0.5rem; }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* Results */
    .results-header { font-family: 'Fredoka One', cursive; color: var(--brown-dark); font-size: 1.4rem; margin-bottom: 1.2rem; }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 1.2rem; }
    .card { background: var(--card-bg); border-radius: 20px; border: 3px solid var(--brown-dark); overflow: hidden; box-shadow: 4px 6px 0 var(--brown-dark); transition: transform 0.18s, box-shadow 0.18s; animation: popIn 0.4s cubic-bezier(.34,1.56,.64,1) both; }
    .card:hover { transform: translateY(-4px) rotate(-1deg); box-shadow: 6px 10px 0 var(--brown-dark); }
    @keyframes popIn {
      from { opacity: 0; transform: scale(0.7) rotate(-4deg); }
      to   { opacity: 1; transform: scale(1) rotate(0deg); }
    }
    .card img { width: 100%; height: 190px; object-fit: cover; display: block; background: #e8d5b7; }
    .card-body { padding: 0.8rem 1rem 1rem; }
    .card-title { font-weight: 800; color: var(--brown-dark); font-size: 0.95rem; line-height: 1.4; margin-bottom: 0.3rem; }
    .card-desc  { font-size: 0.8rem; color: #7a5c3a; font-weight: 600; margin-bottom: 0.3rem; }
    .card-source{ font-size: 0.78rem; color: var(--brown-light); font-weight: 600; }
    .card-link { display: inline-block; margin-top: 0.6rem; background: var(--brown-dark); color: var(--accent); padding: 0.3rem 0.9rem; border-radius: 20px; font-size: 0.8rem; font-weight: 800; text-decoration: none; transition: background 0.2s; }
    .card-link:hover { background: var(--brown-mid); }
    .ai-answer { background: #fff; border: 3px solid var(--brown-dark); border-radius: 20px; padding: 1.2rem 1.5rem; margin-bottom: 2rem; box-shadow: 4px 6px 0 var(--brown-dark); font-size: 0.97rem; color: var(--brown-dark); font-weight: 600; line-height: 1.6; }
    .ai-answer strong { color: var(--brown-mid); }
    .empty { text-align: center; padding: 3rem 1rem; color: var(--brown-light); font-size: 3rem; }
    .empty p { font-size: 1rem; font-weight: 700; margin-top: 0.5rem; }
    footer { text-align: center; margin-top: 3rem; font-size: 0.8rem; color: var(--brown-light); font-weight: 700; letter-spacing: 0.04em; }
  </style>
</head>
<body>

<div class="bg-emojis" id="bgEmojis"></div>

<div class="wrapper">
  <header>
    <span class="logo">üí©</span>
    <h1>Caca<span>Finder</span></h1>
    <p class="tagline">Le moteur de recherche ultime pour les photos de caca üí©</p>
  </header>

  <!-- Section cl√© API -->
  <section class="apikey-section" id="apikeySection">
    <div class="apikey-box">
      <label for="apiKey">üîë Entre ta cl√© API Anthropic pour commencer</label>
      <div class="apikey-row">
        <input type="password" id="apiKey" placeholder="sk-ant-api03-..." autocomplete="off" />
        <button onclick="saveKey()">Valider ‚úì</button>
      </div>
      <p class="apikey-hint">
        Obtiens ta cl√© gratuitement sur
        <a href="https://console.anthropic.com/settings/keys" target="_blank">console.anthropic.com</a>
        ¬∑ Stock√©e dans ton navigateur, jamais envoy√©e ailleurs que l'API Anthropic.
      </p>
    </div>
  </section>

  <!-- Section recherche (cach√©e jusqu'√† validation de la cl√©) -->
  <section class="search-section" id="searchSection">
    <div style="display:flex;justify-content:flex-end;margin-bottom:0.7rem">
      <div id="keyIndicator"></div>
    </div>
    <div class="search-box">
      <input type="text" id="searchInput" placeholder="Ex: caca de chien, caca de panda..." value="caca" />
      <button onclick="search()">üîç Chercher</button>
    </div>
    <div class="quick-tags">
      <button class="tag" onclick="quickSearch('caca de chien')">üêï Chien</button>
      <button class="tag" onclick="quickSearch('caca de chat')">üêà Chat</button>
      <button class="tag" onclick="quickSearch('caca de panda')">üêº Panda</button>
      <button class="tag" onclick="quickSearch('caca de vache')">üêÑ Vache</button>
      <button class="tag" onclick="quickSearch('caca fossile')">ü¶¥ Fossile</button>
      <button class="tag" onclick="quickSearch('caca de baleine')">üê≥ Baleine</button>
      <button class="tag" onclick="quickSearch('emoji caca')">üí© Emoji</button>
      <button class="tag" onclick="changeKey()">üîë Changer la cl√©</button>
    </div>
  </section>

  <div class="status" id="status"></div>
  <div id="results"></div>

  <footer>üí© CacaFinder ‚Äî Propuls√© par Claude + Recherche Web üí©</footer>
</div>

<script>
  /* ‚îÄ‚îÄ Floating emojis ‚îÄ‚îÄ */
  const bgContainer = document.getElementById('bgEmojis');
  ['üí©','üí©','üí©','üöΩ','üßª'].forEach(() => {
    for (let i = 0; i < 4; i++) {
      const el = document.createElement('span');
      el.textContent = ['üí©','üöΩ','üßª'][Math.floor(Math.random()*3)];
      el.style.left = Math.random() * 100 + 'vw';
      el.style.animationDuration = (12 + Math.random() * 20) + 's';
      el.style.animationDelay = (Math.random() * 20) + 's';
      el.style.fontSize = (1.2 + Math.random() * 2) + 'rem';
      bgContainer.appendChild(el);
    }
  });

  /* ‚îÄ‚îÄ API Key ‚îÄ‚îÄ */
  const KEY = 'cacafinder_key';

  function saveKey() {
    const val = document.getElementById('apiKey').value.trim();
    if (!val.startsWith('sk-ant-')) {
      alert('‚ùå La cl√© doit commencer par "sk-ant-"');
      return;
    }
    localStorage.setItem(KEY, val);
    showSearch();
  }

  function changeKey() {
    localStorage.removeItem(KEY);
    document.getElementById('apikeySection').style.display = '';
    document.getElementById('searchSection').style.display = 'none';
    document.getElementById('results').innerHTML = '';
    document.getElementById('status').innerHTML = '';
    document.getElementById('apiKey').value = '';
  }

  function getKey() { return localStorage.getItem(KEY) || ''; }

  function showSearch() {
    document.getElementById('apikeySection').style.display = 'none';
    document.getElementById('searchSection').style.display = '';
    const k = getKey();
    document.getElementById('keyIndicator').innerHTML =
      `<span class="key-saved" onclick="changeKey()">‚úÖ ${k.slice(0,14)}‚Ä¶ ¬∑ changer</span>`;
  }

  // Init
  document.getElementById('searchSection').style.display = 'none';
  if (getKey()) showSearch();
  document.getElementById('apiKey').addEventListener('keydown', e => { if (e.key === 'Enter') saveKey(); });
  document.getElementById('searchInput').addEventListener('keydown', e => { if (e.key === 'Enter') search(); });

  /* ‚îÄ‚îÄ Search ‚îÄ‚îÄ */
  function quickSearch(q) {
    document.getElementById('searchInput').value = q;
    search();
  }

  async function search() {
    const query = document.getElementById('searchInput').value.trim();
    if (!query) return;
    const apiKey = getKey();
    if (!apiKey) { alert('Entre ta cl√© API d\'abord !'); return; }

    const status  = document.getElementById('status');
    const results = document.getElementById('results');
    status.innerHTML = '<span class="spinner"></span> L\'IA cherche du caca pour toi...';
    results.innerHTML = '';

    try {
      const fullQuery = query.toLowerCase().includes('caca') ? query : `caca ${query}`;

      const res = await fetch('https://api.anthropic.com/v1/messages', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'x-api-key': apiKey,
          'anthropic-version': '2023-06-01',
          'anthropic-dangerous-direct-browser-access': 'true'
        },
        body: JSON.stringify({
          model: 'claude-sonnet-4-20250514',
          max_tokens: 1000,
          system: `Tu es CacaFinder, un moteur de recherche sp√©cialis√© dans les photos de caca.
R√©ponds UNIQUEMENT en JSON valide, sans markdown ni backticks.
Format:
{
  "summary": "Description fun en 2-3 phrases (fran√ßais)",
  "results": [
    {
      "title": "Titre descriptif",
      "description": "Description courte et fun",
      "imageUrl": "URL directe vers une vraie image publique (jpg/png/gif/webp)",
      "sourceUrl": "URL de la page source",
      "source": "Nom du site"
    }
  ]
}
Trouve 4 √† 6 r√©sultats avec de vraies URLs d'images accessibles publiquement via ta recherche web.`,
          messages: [{ role: 'user', content: `Cherche des photos de: ${fullQuery}` }],
          tools: [{ type: 'web_search_20250305', name: 'web_search' }]
        })
      });

      if (!res.ok) {
        const err = await res.json().catch(() => ({}));
        throw new Error(err?.error?.message || `Erreur HTTP ${res.status}`);
      }

      const data = await res.json();
      const text = data.content.filter(b => b.type === 'text').map(b => b.text).join('');

      let parsed;
      try {
        parsed = JSON.parse(text.replace(/```json|```/g, '').trim());
      } catch {
        const m = text.match(/\{[\s\S]*\}/);
        if (m) parsed = JSON.parse(m[0]);
        else throw new Error('R√©ponse inattendue de l\'IA');
      }

      status.innerHTML = '';
      render(parsed, query);

    } catch (err) {
      status.innerHTML = `üò± <strong>Erreur :</strong> ${esc(err.message)}`;
      console.error(err);
    }
  }

  function render(data, query) {
    const results = document.getElementById('results');
    let html = '';

    if (data.summary)
      html += `<div class="ai-answer">üí© <strong>CacaFinder dit :</strong> ${esc(data.summary)}</div>`;

    const items = data.results || [];
    if (!items.length) {
      html += `<div class="empty">üò¢<p>Aucun caca trouv√© pour "${esc(query)}"‚Ä¶</p></div>`;
    } else {
      html += `<div class="results-header">üí© ${items.length} r√©sultat${items.length > 1 ? 's' : ''} trouv√©${items.length > 1 ? 's' : ''}</div><div class="grid">`;
      items.forEach((item, i) => {
        const thumb = item.imageUrl
          ? `<img src="${esc(item.imageUrl)}" alt="${esc(item.title||'')}" loading="lazy" onerror="this.style.display='none'" />`
          : `<div style="height:190px;display:flex;align-items:center;justify-content:center;font-size:4rem;background:#f5e6cf">üí©</div>`;
        html += `
          <div class="card" style="animation-delay:${i * 0.07}s">
            ${thumb}
            <div class="card-body">
              <div class="card-title">${esc(item.title || 'Photo de caca')}</div>
              ${item.description ? `<div class="card-desc">${esc(item.description)}</div>` : ''}
              ${item.source     ? `<div class="card-source">üìç ${esc(item.source)}</div>` : ''}
              ${item.sourceUrl  ? `<a class="card-link" href="${esc(item.sourceUrl)}" target="_blank" rel="noopener">Voir la source ‚Üí</a>` : ''}
            </div>
          </div>`;
      });
      html += '</div>';
    }
    results.innerHTML = html;
  }

  function esc(s) {
    return String(s || '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
  }
</script>
</body>
</html>
